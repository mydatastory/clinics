---
title: "Sardine Story"
author: "Charlotte Bolch"
date: "10/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

P1. Intro1
Shot of Wendy talking to her grandfather, Ed Ricketts Jr. on the deck of an old fishing boat that's seen better days: the SS Teinbeck.
**Wendy:** What was it like working in Monterey at great grandfather's Western Biological Station, grandpa?
**Grandfather:** It was an extremely busy time to be working in the sardine industry. It was tricky to locate the sardines in the waves of the Pacific ocean, so the latest technology was used with the assistance of US Navy pilots. */

Pl. Intro2
Still on the boat, as grandpa is doing too much heavy lifting on deck
Shot of Wendy and Grandfather looking at a map (Fig 3.1 from sardine_rise_fall article, page 32). Highlight the Central California Fisheries of Monterey.
**Grandfather:** By the time I started leading my own crew in 1945, the total sardine catch per year for the central California fishery was 148,000 tons.
**Wendy:** Wow! That's a lot of sardine cans. Weren't people sick of eating them?
**Grandfather:** Not if the canned sardines have the flavor and quality of French brands, but were at a lower price!

Pl. Intro3
Shot of Grandfather looking perplexed and confused.
**Grandfather:** By 1953, the sardine industry had disappeared. And just like that all the jobs involving the sardine industry were gone.
**Wendy:** What happened?
**Grandfather:** That is something that I have never been able to figure out. Did we overfish? Was there something else that impacted the sardine population which left our world forever altered? I only wish there was something we could do to save the family business...

Grandfather topples over and the next shot moves the scene into the hospital

P1. Intro4
Shot of Wendy looking at her grandfather in his condition, hospital monitors as a nurse enters the room to check on Ed Ricketts Jr.
**Nurse:** Wendy, I'm afraid your grandfather is in critical condition and we're going to have to monitor him overnight. It's a good thing you were on the boat with him, or else he might not have made it here to us today.

Wendy holding her grandfather's hand at his bedside.
**Wendy:** (internal) Grandfather, I am going to find out what may have caused the sardine industry to collapse. I promise to find a solution as fast as I can.

## End of Introduction

## Start of Datastory

Pl. 1
Shot of Wendy at the computer in her bedroom getting ready to start the analysis of the sardine data. Several older logs and books are strewn about, suggesting she compiled the data digitally herself
**Wendy:** I'm really looking forward to diving into this data to see what I can figure out about what happened to the sardine industry!

Pl. 2
Zoom in on Wendy's computer which has a sample of the sardine dataset.
**Wendy:** Well, I see in this dataset of ocean temperatures a lot of rows that have the same year. So this must mean that each row in this dataset has a recording of the ocean temperature for that day.

Pl. 3
Zoom in on Wendy's face that looks overwhelmed.
**Wendy:** Oh wow! That is a lot of data! I think I'm going to need some help...but I don't know who to ask...
Wendy's phone unexpectedly rings on the table

Pl. 4
Split shot of Wendy on the phone with Andy.
**Wendy:** (Confused) H-hello?
**Andy:** Acme Data Consulting.
**Wendy:** (surprised) H-hi. I'm in need of some consulting help to figure out how to process this dataset of daily ocean temperatures, but how did you--
DataDog pushes Andy off the phone, snatching it away.
**DataDog:** Did you say DATA? I LOVE DATA! All about the data and the coding. We at Acme Data Consulting are all about programming perfection!
**Wendy:** Well, great! Let me tell you what my research questions are and show you the datasets that I have...

Pl. 5
Shot of Wendy with word blurb asking the following questions to the audience.

1. What is the relationship between the sardine catch and ocean temperature during peak spawning season?

2. How can I predict the sardine landings (total sardine catch) using ocean temperature data?

# Data Setup and Cleaning
## With DataDog as narrator

## Environment setup and load the two datasets.  
Pl. 6
**DataDog:** The first dataset that Wendy has from her grandfather is ocean temperature readings from La Jolla, CA. The other dataset contains sardine landings in tons. Sardine landings are the total number of sardines that were caught each day. Now, let's get started with my favorite part, programming! As Dr. DataDog, I'm here to help you write code that is perfectly flawless!

```{r data setup}
library(dplyr)

temps_df    <- read.csv("~/UF/Fall 2019/stories/data/scripps_ocean_temps.csv")
landings_df <- read.csv("~/UF/Fall 2019/stories/data/sardine_landings_ueber.csv")

```

## Data cleaning
Pl. 7
**DataDog:** Now that we have the data imported into R, we can start the first part of every good code program, the data cleaning process. Wendy explained to me based on her conversation with her grandfather that the onset of sardine spawning begins in February. This means that we need to create a subset of the temperature data from February to April. This dataset will be the peak spawning season. Then we will create a new dataset that contains the average temperatures for each year of the peak spawning season.

## Technical video about data manipulation HERE
Pl. 8
**DataDog:** Using the subset command and then grouping the data to calculate the mean for each year is the way that I write my code to be accurate and clean. I never want to loose important data points when data cleaning! Click here for a video about how to perform data cleaning using the subset and summarize commands.

```{r sardine_1}
temps_df <- temps_df[,-5]
temps_df <- na.omit(temps_df)
temps_df <- subset(temps_df, month == 2 | month == 3 | month == 4)
temps_df <- subset(temps_df, year < 1968)

avg_temps_df <- temps_df %>%
                  group_by(year) %>%
                  summarize(mean(surf_temp_c))

colnames(avg_temps_df)[2] <- "avg_temp"
```


## Graphing the data
Pl. 9
**DataDog:** Now that our code is perfect and we have a dataset that contains average ocean temperatures by year, we need to create a graph to see what is going on in the data. Let's create a graph with the year on the x-axis and the average ocean temperature on the y-axis.  

```{r sardine_2}

plot(avg_temps_df$year, avg_temps_df$avg_temp,                  
     type = "l",
     col  = "blue",
     main = "",
     xlim = c(1915, 1970),
     xlab = "Year",
     ylab = 'Temperature (Celsius)')

```

Pl. 10
**DataDog:** Viola, you are a coding genuis just like me! Let's keep coding and move onto predicting the sardine landings.  
**Wendy:** Hold on, DataDog! Not so fast, let's take a closer look at this graph.

### QUESTIONS:
Pl. 11
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. What do you observe from this line graph?
    i. Does the temperature of the ocean change over the years? If so, how?

2. Are you able to identify an overall trend from this line graph?

Pl. 12
**DataDog:** I guess Wendy is right...we should take time to look at the graphs we make to see what is going on with the data. Let's make another graph with the sardine landings data. For this graph, the year variable will be on the x-axis and the variable "monterey_tons" will be on the y-axis.

```{r sardine_3}

plot(landings_df$year, landings_df$monterey_tons,                  
     type = "l",
     col  = "blue",
     main = "",
     xlim = c(1915, 1970),
     xlab = 'Year',
     ylab = 'Landings (Tons)')

```

### QUESTIONS:
Pl. 13
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. What do you observe from this line graph?
    i. Does the amount of sardine landings change over the years? If so, how?

2. Are you able to identify an overall trend from this line graph?

3. Looking at both line graphs of the raw temperature and sardine landings data, do you notice any relationship between the two variables? Take note of the x-axis which allows us to compare these two graphs.

**Wendy:** Thanks, DataDog! I'm going to go talk to my grandfather and see what he thinks about the graphs.

Pl. 14
Shot of Wendy bringing her computer to visit her grandfather.
**Wendy:** Grandfather, I was able to create graphs of the ocean temperatures and sardine landings for the years 1915-1968 for the peak spawning months. Do you see any trend or pattern from the graphs?
**Grandfather:** I'm not seeing anything at all in these two graphs! The data has a lot of noise in both graphs which is making it difficult to see if the ocean temperatures and sardine landings are increasing or decreasing over the years.
**Wendy:** That's true. I think I need to call on StatCat for some help in smoothing out the curve. He will know what to do given his smooth skills in statistics!

Pl. 15
Shot of Wendy and StatCat talking and looking at Wendy's computer.
**Wendy:** StatCat, are there any statistical techniques that I could use to smooth out the curves in these graphs to figure out if there is a real trend in the data?
**StatCat:** Did you say, smooth? That's what I'm all about, using my smooth statistics skills to make sense of the data! It looks like a smoothing technique called the loess line would work for these two datasets.

# Smoothing Technique: Loess Line
## With StatCat as narrator
Pl. 16
Shot of StatCat showing off this smooth skills
**StatCat:** Let's try a smoothing technique called the loess line for the temperature dataset. To do this we need to create a temperature model, called loess. Then we can generate predicted values using that model, and lay down a smoothing line on top of the graph. Click on the link below to learn about the loess line.

## Technical video about the loess line HERE

```{r sardine_4}

temp_model <- loess(avg_temp ~ year, data = avg_temps_df, span = .50)
temp_line  <- predict(temp_model)

plot(avg_temps_df$year, avg_temps_df$avg_temp,                  
     type = "l",
     col  = "blue",
     main = "",
     xlim = c(1915, 1970),
     xlab = "Year",
     ylab = 'Temperature (Celsius)')

lines(temp_line, x = avg_temps_df$year, col = 'red')

```

Pl. 17
**StatCat:** Let's use our smoothing skills again for the sardine landings dataset. You will be an expert in smoothing curves out like me in no time!

```{r sardine_5}

landing_model <- loess(monterey_tons ~ year, data = landings_df, span = .50)
landing_line  <- predict(landing_model)

plot(landings_df$year, landings_df$monterey_tons,                  
     type = "l",
     col  = "blue",
     main = "",
     xlim = c(1915, 1970),
     xlab = 'Year',
     ylab = 'Landings (Tons)')

lines(landing_line, x = landings_df$year, col = 'red')

```

Pl. 18
Shot of Wendy and StatCat looking at the new plots with the smoothing lines.
**Wendy:** Wow, thanks StatCat!
**StatCat:** Smooth is my middle name.
**Wendy:** Let's take a closer look at these two graphs with the loess lines.

### QUESTIONS:
Pl. 19
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. What do you observe from each of these line graphs with the loess lines?
    i. Are you able to identify a better overall trend using the loess lines for the temperature and sardine landings variables?

2. Can you describe the relationship between the two variables better now with the loess lines?

3. What do you notice between the two line graphs? How do they compare? How are they different?

### Story check-in here with grandfather and Wendy?

Pl. 20
**Wendy:** (setup for next section about correlation and linear regression)
Now that we can better identify the trend of the temperature and sardine landings over the years, let's take a closer look at the relationship between these two variables. We know that sardines need an ideal temperature in order to catch and grow their population. In order to better understand the change in sardine landings over the years, we will use the temperature data to predict the amount of sardine landings. This type of technique is called linear regression. Click here to watch a video about simple linear regression and correlation.

## Technical video about simple linear regression and correlation HERE

## Raw Temperature and Landing Correlation and Regression
Pl. 21
**DataDog:** We need to first join the two datasets of the raw average ocean temperatures and raw landings using the variable year. Then, we need to retain only those years where the catch was greater than 500 tons. When the catch was less than 500 tons, the fishery was effectively shutdown so we don't want to have those years in our joined dataset. Finally, let's write some exceptional code to graph the data! Let's get started on subsetting that data with your exceptional coding skills.  

## Merge and graph the raw data

```{r sardine_6}

analysis_df_raw <- merge(avg_temps_df, landings_df, by = 'year')
analysis_df_raw <- subset(analysis_df_raw, monterey_tons > 500)
analysis_df_raw <- subset(analysis_df_raw, year < 1954)

plot(x = analysis_df_raw$avg_temp, y = analysis_df_raw$monterey_tons,
     xlab = 'Surface Temp (Celsius)',
     ylab = 'Tons')

```

### QUESTIONS:
Pl. 22
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. What can you say visually about the relationship between the average surface temperatures and the catch in tons?
    i. Is the relationship positive or negative? Strong or weak?

2. Think about where you would place the linear regression line on the graph.

## Correlation for the raw data
Pl. 23
**StatCat:** We need to now calculate a Pearson's correlation coefficient to help us understand the relationship between ocean temperatures and landings. The way that I know how to calculate this value is using paper and pencil, but this dataset is really big....
**DataDog:** I can help! I know this great function in R called "cor" which can caluclate the correlation value between two variables.

```{r sardine_7}

raw_cor <- cor(analysis_df_raw$monterey_tons, analysis_df_raw$avg_temp)

```

### QUESTION:
Pl. 24
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. Does the correlation value align with your visual interpretation of the relationship between the surface temperature and the sardine catch?

## Simple linear regression with raw data
Pl. 25
**StatCat:** Now we need to use our statistics expertise to generate a simple linear regression model and add the regression line to the graph. I know that calculating the difference between our observed and predicted values to minimize the variance is not something that you want to do by hand, so...
**DataDog:** I have code that will do that in no time!

```{r sardine_8}

fit_raw <- lm(analysis_df_raw$monterey_tons ~ analysis_df_raw$avg_temp)

plot(x = analysis_df_raw$avg_temp, y = analysis_df_raw$monterey_tons,
     xlab = 'Surface Temp (Celsius)',
     ylab = 'Tons')

abline(fit_raw, col = 'red')

```

### QUESTIONS:
Pl. 26
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. How does the linear regression line compare to your estimated regression line?

2. Overall, what does Pearson's r and the simple linear regression model tells us about surface temperature as a predictor for the sardine catch?

## Story Check-in here? Need a transition to the smoothed data

## Smoothed Temperature and Landing Regression & Correlation
### Scaffolding of coding to prepare students for final exercise. Code chunks provided but minimal text.
Pl. 27
**Wendy:** (setup for next section)
Now that we've conducted a simple linear regression and correlation value with the raw data, let's do the same with the smoothed data from our loess model. Let's see if you can apply what you learned in the previous section with the raw data to the smoothed data. With the smoothing line vectors, create two new dataframes. Add a year variable, populate it with values from 1917 to 1967, and then join both into an analysis dataframe. Remove rows from analysis_df for years when the fishery was shut down. Graph the new dataset.  

Data Note:  landing_df and temp_df contain smoothed data.

## Merge and graph the smoothed data

```{r sardine_9}

landing_df <- data.frame("landings" = landing_line)
temp_df    <- data.frame("temps" = temp_line)

landing_df$year <- 1917:1967
temp_df$year    <- 1917:1967

analysis_df_smooth <- merge(temp_df, landing_df, by = 'year')
analysis_df_smooth <- subset(analysis_df_smooth, landings > 500)
analysis_df_smooth <- subset(analysis_df_smooth, year < 1954)

plot(x = analysis_df_smooth$temps, y = analysis_df_smooth$landings,
     xlab = 'Surface Temp (Celsius)',
     ylab = 'Tons')

```

### QUESTIONS:
Pl. 28
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. What can you say visually about the relationship between the smooth surface temperatures data and the smooth catch data?
    i. Is the relationship positive or negative? Strong or weak?

2. Think about where you would place the linear regression line on the graph.

## Correlation for the smoothed data

Calculate Pearson's r between the smooth temperature and landings data.

```{r sardine_10}

smooth_cor <- cor(analysis_df_smooth$landings, analysis_df_smooth$temps)

```

### QUESTION:
Pl. 29
Shot of Wendy asking the following question to the audience.
**Wendy:**
1. Does the correlation value align with your visual interpretation of the relationship between the surface temperature and the sardine catch?

## Simple linear regression with smoothed data

Generate a simple linear regression model and add the regression line to the graph for the smooth data.

```{r sardine_11}

fit_smooth <- lm(analysis_df_smooth$landings ~ analysis_df_smooth$temps)

plot(x = analysis_df_smooth$temps, y = analysis_df_smooth$landings,
     xlab = 'Surface Temp (Celsius)',
     ylab = 'Tons')

abline(fit_smooth, col = 'red')

```

### QUESTIONS:
Pl. 30
Shot of Wendy asking the following questions to the audience.
**Wendy:**
1. Does the correlation value for the smoothed data align with your visual interpretation of the
relationship between the smoothed surface temperature data and the smoothed sardine catch data?

2. How does the linear regression line of the smoothed data compare to your estimated regression line?

### Overall Questions
1. Overall, how does the linear regression line and the correlations compare between the smoothed
and raw data?

2. What does this tell us about using temperature data to predict sardine landings?

## Story check-in
Pl. 31
Shot of Wendy bringing her results back to her grandfather to share what she found
**Wendy:** Grandfather, I think I found a reason for why the sardine landings decreased before 1968!
**Grandfather:** Glad to hear, what did you find?
**Wendy:** The ocean temperatures during that same time increased and then decreased. However, it looks like ocean temperatures are not able to explain all the variation in sardine landings. **Anything more here?** 

Pl. 32
**StatCat**: Now it is your turn to try your statistical skills and smoothing techniques!

# Exercise

## Looking at data from 1968 to 2018
Now that we have looked at the sardine catch and ocean temperature data before 1968, let's investigate any possible trends in the data after 1968.

#### What question do you want this exercise to be based on?

### Steps:
1. Subset the sardine catch and temperature data to have year >= 1968 and month only Feburary to April.

2. Create separate graphs from the raw data for temperature and sardine landings.

3. **QUESTIONS:**
    i. What do you see from the graphs? What comparisons can you make between the data from before 1968 and the data after 1968?
    ii. What data should be used to move forward in this investigation?

4. Use the temperature data to predict sardine landings after 1968. Make an appropriate graph with a linear regression line using the data selected and interpret the correlation value.

5. **QUESTION:**
    i. What do you see from the graph using the subset of data after 1968?
